/*! digitalScroll - v2.0.0 - 2013-08-12 2:16:53 PM
* Copyright (c) 2013 函谷; Licensed  */
KISSY.add("kg/digitalScroll/2.0.0/index",function(a,b,c,d){"use strict";function e(a){e.superclass.constructor.call(this,a),this.initializer()}var f=a.UA.gecko>0,g="reset",h="error",i="end";return a.extend(e,c,{initializer:function(){var c=this,d=c.get("data"),e=c.get("nodeList"),f=c.get("durationList"),g=c.get("uHeight"),i=c.get("exec"),j=[];return null==e?j.push("error: missing parameter nodeList"):a.isArray(e)||j.push("error: error parameter nodeList"),null==f?j.push("error: missing parameter durationList"):a.isArray(f)||(f=c._buildArray(f),c.set("durationList",f)),e.length!=f.length&&(j="error: nodeList and durationList must hava same length"),j.length?(c.fire(h,{msg:j}),void 0):(g||c.set("uHeight",b.height(e)),c._oldData=this._buildArray(),d&&i.auto&&setTimeout(function(){c.start()},1e3*i.delay),c)},destroy:function(){return this.stop(),this.detach(),delete this._reverse,delete this._transitionTag,delete this._transitionIndex,delete this._delayStop,delete this._oldData,this.set("nodeList",null),this.set("durationList",null),null},reset:function(a){var b=this;return a||(a=this._buildArray()),b.set("data",a,{error:function(){b.fire(h,{msg:"error: error parameter data, must be array"})}})&&b.fire(g,{newVal:a,oldVal:b._oldData}),b},start:function(a){return this._reverse=a?!0:!1,this.stop()._execTransition(),this},stop:function(a){if(a)return this._stopTransition().end(),this.set("status",!1),this.fire(i),this;if(this._transitionTag){var b=this.get("transition");this._transitionIndex<b.minRepeat?this._delayStop=!0:this._stopTransition()}return this},isRunning:function(){return this.get("status")},_buildArray:function(b){var c=[];return a.each(this.get("nodeList"),function(){c.push(b?b:0)}),c},_execTransition:function(){var a=this.get("transition");if(!a)return this._execMain(),void 0;var b=this._buildTransition();this.get("nodeList"),this.set("status",!0),b?(this._transitionTag=!0,this._transitionIndex=1,b.run()):this._execMain()},_stopTransition:function(){return this.transitionAnim.stop(),this._transitionTag=!1,this._delayStop=!1,this._transitionIndex=1,this._execMain()},_buildTransition:function(){var c,e=this,g=this.get("nodeList"),h=this.get("transition"),i=[];return this.transitionAnim?this.transitionAnim:(this._delayStop=!0,this.set("mode",2),a.each(g,function(a){if(f){var c=b.css(a,"backgroundPosition").split(" ")[0];i.push({node:a,from:{backgroundPosition:c+" -"+h.minY+"px"},to:{backgroundPosition:c+" -"+h.maxY+"px"},duration:h.duration})}else i.push({node:a,from:{backgroundPositionY:"-"+h.minY+"px"},to:{backgroundPositionY:"-"+h.maxY+"px"},duration:h.duration})}),c=this.transitionAnim=new d(i),c.on("end",function(){e._delayStop&&e._transitionIndex>=h.minRepeat?e._stopTransition():e._transitionIndex>=h.maxRepeat?e._stopTransition():(e._transitionIndex++,c.rerun())}),c)},_execMain:function(){var c,e,g=this,h=this.get("mode"),j=this.get("data"),k=this.get("uHeight"),l=this.get("nodeList"),m=this.get("durationList"),n=this.get("delayList"),o=this.get("easing"),p=this.get("fixed"),q=[];if(1==h){var r=this.get("rangeList"),s=this._oldData,t=this._reverse;if(s&&s.join("-")==j.join("-"))return;this._oldData=j,a.each(l,function(a,d){var e,g=j[d],h=s?s[d]:0,i=r?r[d]:10,l=i*k;if(t?(c=-g*k+p,e=-h*k-(h>=g?0:l)+p):(c=-g*k-(g>=h?0:l)+p,e=-h*k+p),f){var u=b.css(a,"backgroundPosition").split(" ")[0];q.push({node:a,from:{backgroundPosition:u+" "+e+"px"},to:{backgroundPosition:u+" "+c+"px"},delay:n?n[d]:0,duration:m[d],easing:o})}else q.push({node:a,from:{backgroundPositionY:e+"px"},to:{backgroundPositionY:c+"px"},delay:n?n[d]:0,duration:m[d],easing:o})})}else 2==h&&a.each(l,function(a,d){if(c=-j[d]*k+p,f){var e=b.css(a,"backgroundPosition").split(" ")[0];q.push({node:a,from:{backgroundPosition:e+" 0px"},to:{backgroundPosition:e+" "+c+"px"},delay:n?n[d]:0,duration:m[d],easing:o})}else q.push({node:a,from:{backgroundPositionY:"0px"},to:{backgroundPositionY:c+"px"},delay:n?n[d]:0,duration:m[d],easing:o})});return e=new d(q),e.on("end",function(){g.set("status",!1),g.fire(i)}),e.run(!0),e}},{ATTRS:{data:{value:null,validator:function(b){if(!a.isArray(b))return!1;var c=this.get("data");return c&&b.length!=c.length?!1:!0}},nodeList:{value:null},durationList:{value:null},delayList:{value:null},rangeList:{value:null},mode:{value:1},exec:{value:{auto:!0,delay:.1}},uHeight:{value:null},easing:{value:"Linear.easeNone"},transition:{value:null},status:{value:!1},fixed:{value:0}}}),e},{requires:["dom","base","kg/layer-anim/2.0.0/"]});